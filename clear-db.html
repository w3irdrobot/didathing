<!DOCTYPE html>
<html>
<head>
  <title>Clear IndexedDB</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      max-width: 600px;
      margin: 0 auto;
    }
    button {
      padding: 1rem 2rem;
      font-size: 1rem;
      cursor: pointer;
      margin: 0.5rem;
    }
    .danger { background: #dc2626; color: white; }
    .info { background: #2563eb; color: white; }
    pre {
      background: #f5f5f5;
      padding: 1rem;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>IndexedDB Debug Tool</h1>
  
  <div>
    <button class="info" onclick="checkDB()">Check Database Status</button>
    <button class="danger" onclick="clearDB()">Delete Database</button>
  </div>

  <div id="output"></div>

  <script>
    const DB_NAME = 'DidAThingDB';
    const output = document.getElementById('output');

    async function checkDB() {
      output.innerHTML = '<p>Checking database...</p>';
      
      try {
        const request = indexedDB.open(DB_NAME);
        
        request.onsuccess = (event) => {
          const db = event.target.result;
          const info = {
            name: db.name,
            version: db.version,
            objectStores: Array.from(db.objectStoreNames)
          };
          
          output.innerHTML = `
            <h3>Database Info</h3>
            <pre>${JSON.stringify(info, null, 2)}</pre>
          `;
          
          db.close();
        };
        
        request.onerror = (event) => {
          output.innerHTML = `<p style="color: red;">Error: ${event.target.error.message}</p>`;
        };
      } catch (error) {
        output.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
      }
    }

    async function clearDB() {
      if (!confirm('Delete the entire database? This cannot be undone!')) {
        return;
      }
      
      output.innerHTML = '<p>Deleting database...</p>';
      
      const request = indexedDB.deleteDatabase(DB_NAME);
      
      request.onsuccess = () => {
        output.innerHTML = '<p style="color: green;">✓ Database deleted successfully! Reload the main app to start fresh.</p>';
      };
      
      request.onerror = (event) => {
        output.innerHTML = `<p style="color: red;">Error deleting: ${event.target.error?.message || 'Unknown error'}</p>`;
      };
      
      request.onblocked = () => {
        output.innerHTML = '<p style="color: orange;">⚠ Database deletion blocked. Close all tabs with this app and try again.</p>';
      };
    }
  </script>
</body>
</html>
